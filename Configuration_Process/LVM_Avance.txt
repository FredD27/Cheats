Ã‰tape 1 - Initialisation et crÃ©ation des LV
1ï¸âƒ£ VÃ©rifier si LVM est installÃ©
Ouvre un terminal et tape :
lvm version
ou
apt list --installed lvm2
Si LVM nâ€™est pas installÃ©, installe-le avec :
sudo apt install lvm2 -y

2ï¸âƒ£ Identifier les disques Ã  utiliser
Liste tous les disques prÃ©sents sur ta machine :
sudo fdisk -l
Les disques supplÃ©mentaires devraient Ãªtre /dev/sdb et /dev/sdc.

3ï¸âƒ£ Initialiser les disques pour LVM
ExÃ©cute ces commandes pour prÃ©parer les disques :
sudo pvcreate /dev/sdb
sudo pvcreate /dev/sdc
VÃ©rifie que tout est bien pris en compte avec :
sudo pvdisplay

4ï¸âƒ£ CrÃ©er un groupe de volumes (VG)
On va crÃ©er un groupe de volumes nommÃ© vg_datas en utilisant /dev/sdb et /dev/sdc :
sudo vgcreate vg_datas /dev/sdb /dev/sdc
VÃ©rifie avec :
sudo vgdisplay
Tu dois voir un VG Size correspondant Ã  la somme des deux disques (30 Go).

5ï¸âƒ£ CrÃ©er un volume logique (LV)
On crÃ©e un volume logique de 25 Go appelÃ© lv_datas :
sudo lvcreate -L 25G -n lv_datas vg_datas
VÃ©rifie la crÃ©ation avec :
sudo lvdisplay
Tu dois voir LV Size = 25G.

ğŸ”¬ Ã‰tape 2 - Formatage et montage du systÃ¨me de fichiers (FS)
1ï¸âƒ£ Formater le volume logique en ext4
On doit formater le LV (lv_datas) pour pouvoir lâ€™utiliser :
sudo mkfs.ext4 /dev/vg_datas/lv_datas

2ï¸âƒ£ CrÃ©er un point de montage et monter le LV
On va crÃ©er un rÃ©pertoire /mnt/datas et y monter le volume logique :
sudo mkdir /mnt/datas
sudo mount /dev/vg_datas/lv_datas /mnt/datas
VÃ©rifie que le volume est bien montÃ© avec :
df -h | grep datas
Tu dois voir une ligne avec /mnt/datas et la taille de 25G.

3ï¸âƒ£ Montage automatique au dÃ©marrage
Pour Ã©viter de devoir remonter manuellement aprÃ¨s un redÃ©marrage, on ajoute une ligne dans /etc/fstab :
/dev/vg_datas/lv_datas    /mnt/datas    ext4    defaults   0   2


ğŸ”¬ Ã‰tape 3 - Ã‰tendre le LV
1ï¸âƒ£ VÃ©rifier lâ€™espace libre dans le VG
Avant dâ€™agrandir un volume logique, on doit voir combien dâ€™espace libre est disponible :
sudo vgs
Regarde la colonne VFree pour voir combien de Go restent dans le groupe de volumes vg_datas.

2ï¸âƒ£ Ã‰tendre le LV avec tout lâ€™espace disponible
On va utiliser tout lâ€™espace libre restant pour agrandir lv_datas :
sudo lvextend -l +100%FREE /dev/vg_datas/lv_datas
VÃ©rifie avec :
sudo lvs
Le LV Size doit maintenant Ãªtre plus grand.

3ï¸âƒ£ Redimensionner le systÃ¨me de fichiers
Maintenant que le LV est plus grand, on doit aussi agrandir le systÃ¨me de fichiers pour quâ€™il utilise tout lâ€™espace disponible :
sudo resize2fs /dev/vg_datas/lv_datas
VÃ©rifie avec :
df -h | grep datas
La taille du point de montage /mnt/datas doit maintenant Ãªtre augmentÃ©e. ğŸ‰

ğŸ”¬ Ã‰tape 4 - Ajout d'un disque au PV existant
On va ajouter le disque de 25 Go (/dev/sdd) Ã  notre groupe de volumes vg_datas.

1ï¸âƒ£ Initialiser le nouveau disque
Dâ€™abord, on prÃ©pare le disque pour LVM :
sudo pvcreate /dev/sdd
VÃ©rifie quâ€™il est bien pris en compte avec :
sudo pvdisplay
Tu devrais voir /dev/sdd listÃ© comme Physical Volume.

2ï¸âƒ£ Ajouter le disque au groupe de volumes
On ajoute /dev/sdd Ã  vg_datas :
sudo vgextend vg_datas /dev/sdd
VÃ©rifie avec :
sudo vgs
La valeur VFree doit avoir augmentÃ© de 25 Go.

3ï¸âƒ£ CrÃ©er un nouveau volume logique lv_datas2 de 15 Go
On crÃ©e un nouveau LV dans vg_datas :
sudo lvcreate -L 15G -n lv_datas2 vg_datas
VÃ©rifie avec :
sudo lvdisplay
Tu dois voir un LV Size de 15 Go pour lv_datas2.

4ï¸âƒ£ Formater et monter lv_datas2
Formater le LV en ext4 :
sudo mkfs.ext4 /dev/vg_datas/lv_datas2
CrÃ©er un rÃ©pertoire pour le monter :
sudo mkdir /mnt/datas2
sudo mount /dev/vg_datas/lv_datas2 /mnt/datas2
VÃ©rifie que tout est bien montÃ© :
df -h | grep datas2

5ï¸âƒ£ Montage automatique au dÃ©marrage
Ajoute lâ€™entrÃ©e dans /etc/fstab :
/dev/vg_datas/lv_datas2    /mnt/datas2    ext4    defaults   0   2


ğŸ”¬ Ã‰tape 5 - CrÃ©ation d'un snapshot
Un snapshot est une copie instantanÃ©e dâ€™un volume logique, utile pour les sauvegardes.

1ï¸âƒ£ CrÃ©er un fichier test
On va crÃ©er un fichier dans /mnt/datas2 pour voir l'effet du snapshot :
echo "Contenu avant crÃ©ation du snapshot !" | sudo tee /mnt/datas2/test_file.txt
VÃ©rifie quâ€™il est bien lÃ  :
ls /mnt/datas2
cat /mnt/datas2/test_file.txt

2ï¸âƒ£ CrÃ©er le snapshot
On crÃ©e un snapshot de 5 Go de lv_datas2 :
sudo lvcreate --size 5G --snapshot --name lv_datas_snap /dev/vg_datas/lv_datas2
VÃ©rifie avec :
sudo lvdisplay
Tu devrais voir lv_datas_snap avec le statut snapshot.

3ï¸âƒ£ Monter le snapshot
On crÃ©e un dossier et on monte le snapshot :
sudo mkdir /mnt/datas_snap
sudo mount /dev/vg_datas/lv_datas_snap /mnt/datas_snap
VÃ©rifie quâ€™il contient bien test_file.txt :
ls /mnt/datas_snap
cat /mnt/datas_snap/test_file.txt
Le contenu doit Ãªtre identique Ã  /mnt/datas2.

4ï¸âƒ£ Tester lâ€™indÃ©pendance du snapshot
Ajoute un nouveau fichier dans /mnt/datas2 :
echo "AprÃ¨s crÃ©ation du snapshot" | sudo tee /mnt/datas2/test_file1.txt
VÃ©rifie son apparition :
ls /mnt/datas2
ls /mnt/datas_snap
âœ… Si test_file1.txt nâ€™apparaÃ®t pas dans /mnt/datas_snap, c'est bien un snapshot indÃ©pendant !

5ï¸âƒ£ Supprimer le snapshot
On dÃ©monte et supprime le snapshot :
sudo umount /mnt/datas_snap
sudo lvremove /dev/vg_datas/lv_datas_snap
Confirme avec :
sudo lvdisplay
Le snapshot ne doit plus apparaÃ®tre.

ğŸ”¬ Ã‰tape 7 - Redimensionnement d'un LV
On va rÃ©duire la taille du volume logique lv_datas Ã  15 Go. âš ï¸ Attention, il faut suivre les Ã©tapes dans le bon ordre pour Ã©viter la corruption du systÃ¨me de fichiers !

1ï¸âƒ£ VÃ©rifier lâ€™intÃ©gritÃ© du systÃ¨me de fichiers
Avant de modifier la taille du LV, on doit s'assurer que tout est en bon Ã©tat.
sudo e2fsck -f /dev/vg_datas/lv_datas

2ï¸âƒ£ DÃ©monter le volume logique
Avant de redimensionner, il faut dÃ©monter le LV :
sudo umount /mnt/datas
VÃ©rifie quâ€™il nâ€™est plus montÃ© avec :
df -h | grep datas
Si aucune ligne ne s'affiche, c'est bon !

3ï¸âƒ£ RÃ©duire la taille du systÃ¨me de fichiers
âš ï¸ Important : On rÃ©duit d'abord le systÃ¨me de fichiers Ã  15 Go.
sudo resize2fs /dev/vg_datas/lv_datas 15G

4ï¸âƒ£ RÃ©duire la taille du volume logique
Maintenant quâ€™on a rÃ©duit le systÃ¨me de fichiers, on peut rÃ©duire le volume logique :
sudo lvresize -L 15G /dev/vg_datas/lv_datas
VÃ©rifie avec :
sudo lvs
Le LV Size doit maintenant Ãªtre de 15 Go.

5ï¸âƒ£ VÃ©rifier et remonter le LV
On revÃ©rifie lâ€™intÃ©gritÃ© du systÃ¨me de fichiers aprÃ¨s la modification :
sudo e2fsck -f /dev/vg_datas/lv_datas
Puis on le remonte :
sudo mount /dev/vg_datas/lv_datas /mnt/datas
Et on vÃ©rifie que tout est bon :
df -h | grep datas
