1. Afficher les listes nft
nft list ruleset

Exemple et signification :

flush ruleset
 table inet inet_filter_table {
 chain in_chain {
 type filter hook input priority filter; policy drop;
 ct state established, related accept
 ct state invalid drop
 iifname lo accept
 tcp dport ssh accept
 ip protocol icmp accept
 ip6 nexthdr icmpv6 accept
 }
 }
 # Ajout des rÃ¨gles pour Bareos
 tcp dport { 9101-9103 } ct state new accept

Signification:
ğŸ“Œ 1. RÃ©initialisation des rÃ¨gles
flush ruleset
ğŸ”¹ Explication : Supprime toutes les rÃ¨gles, chaÃ®nes et tables existantes pour partir dâ€™une configuration propre.

ğŸ“Œ 2. CrÃ©ation dâ€™une table de filtrage
table inet inet_filter_table {
ğŸ”¹ Explication :
table inet â†’ CrÃ©e une table qui fonctionne Ã  la fois pour IPv4 et IPv6.
inet_filter_table â†’ Nom de la table, ici utilisÃ©e pour le filtrage des paquets rÃ©seau.

ğŸ“Œ 3. DÃ©finition d'une chaÃ®ne de filtrage pour lâ€™entrÃ©e
chain in_chain {
 type filter hook input priority filter; policy drop;
ğŸ”¹ Explication :
chain in_chain â†’ CrÃ©ation dâ€™une chaÃ®ne appelÃ©e in_chain.
type filter â†’ Indique qu'il s'agit d'une chaÃ®ne de filtrage.
hook input â†’ Cette chaÃ®ne s'applique aux paquets entrant sur la machine.
priority filter â†’ DÃ©finit la prioritÃ© de la chaÃ®ne (niveau par dÃ©faut).
policy drop â†’ Tout le trafic entrant est bloquÃ© par dÃ©faut, sauf si une rÃ¨gle lâ€™autorise explicitement.

ğŸ“Œ 4. Autorisation des connexions dÃ©jÃ  Ã©tablies ou associÃ©es
ct state established, related accept
ğŸ”¹ Explication :
ct state established â†’ Accepte les paquets appartenant Ã  une connexion existante (ex. rÃ©ponse dâ€™un serveur Web aprÃ¨s une requÃªte HTTP).
ct state related â†’ Accepte les connexions liÃ©es Ã  une autre connexion dÃ©jÃ  Ã©tablie (ex. rÃ©ponse ICMP pour un traceroute).

ğŸ“Œ 5. Rejet des paquets invalides
ct state invalid drop
ğŸ”¹ Explication :
ct state invalid â†’ DÃ©tecte et bloque les paquets qui ne font pas partie dâ€™une connexion valide (ex. paquets corrompus).

ğŸ“Œ 6. Autorisation du trafic sur l'interface loopback (localhost)
iifname lo accept
ğŸ”¹ Explication :
iifname lo â†’ Si lâ€™interface dâ€™entrÃ©e est lo (loopback), le trafic est acceptÃ©.
Important pour permettre les communications internes sur la machine (ex. applications locales).

ğŸ“Œ 7. Autorisation des connexions SSH
tcp dport ssh accept
ğŸ”¹ Explication :
tcp dport ssh â†’ Accepte les paquets TCP Ã  destination du port 22 (SSH).
accept â†’ Autorise la connexion pour permettre lâ€™accÃ¨s distant en SSH.

ğŸ“Œ 8. Autorisation du trafic ICMP (ping, traceroute...)
ip protocol icmp accept
ğŸ”¹ Explication :
ip protocol icmp â†’ Accepte les paquets ICMP pour IPv4 (ex. ping, traceroute).
Permet de diagnostiquer les connexions rÃ©seau.

ğŸ“Œ 9. Autorisation du trafic ICMPv6 (pour IPv6)
ip6 nexthdr icmpv6 accept
ğŸ”¹ Explication :
ip6 nexthdr icmpv6 â†’ Accepte les paquets ICMPv6, essentiels pour le bon fonctionnement dâ€™IPv6 (ex. dÃ©couverte de voisinage).

ğŸ“Œ ğŸ”§ Ajout des rÃ¨gles spÃ©cifiques pour Bareos
tcp dport { 9101-9103 } ct state new accept
ğŸ”¹ Explication :
tcp dport { 9101-9103 } â†’ Accepte les connexions TCP sur les ports 9101 Ã  9103 (utilisÃ©s par Bareos, un logiciel de sauvegarde).
ct state new â†’ Cette rÃ¨gle ne s'applique que pour les nouvelles connexions initiÃ©es vers ces ports.

*ğŸ¯ RÃ©sumÃ©
âœ… Politique stricte : Tout est bloquÃ© sauf les services explicitement autorisÃ©s.
âœ… Connexion SSH autorisÃ©e pour l'administration Ã  distance.
âœ… Trafic ICMP autorisÃ© pour le diagnostic rÃ©seau.
âœ… Support dâ€™IPv6 avec ICMPv6.
âœ… Ports Bareos ouverts pour permettre les sauvegardes.
